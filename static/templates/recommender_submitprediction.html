<br />
<p>Current Score: {{ score.0.value }}</p>
<p>Submit prediction for <a href="https://raw.githubusercontent.com/pushkar/mmovielens/master/u.test">u.test</a> in this format. Here the first element is the
    <code>userid</code>, second is the
    <code>itemid</code> and third is the
    <code>rating</code>.
</p>

<pre width="10px">
    53,181,4
    53,199,5
    53,228,3
    53,250,2
    53,281,4
    53,845,3 ...
</pre>
<br />
<br />

<form id="prediction-form" class="form-group" action="" method="post">{% csrf_token %}
    <div class="form-group">
        <div class="fieldWrapper">
            <label for="test_data">Prediction:</label>
            <br /> {{ form.test_data }} {{ form.test_data.errors }}
        </div>
    </div>
    <div class="form-group">
        <p>
            <button class="btn btn-primary" type="submit" value="Submit">Submit</button>
        </p>
    </div>
</form>

<script type="text/javascript">
    (function(window,undefined){

        // Bind to StateChange Event
        History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
            var State = History.getState(); // Note: We are using History.getState() instead of event.state
        });

        // Change our States
        History.pushState({page:"prediction"}, "Prediction Page", "?page=prediction"); // logs {state:1}, "State 1", "?state=1"
    })(window);

    // Submit post on submit
    $('#prediction-form').on('submit', function(event){
        event.preventDefault();
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "{% url 'recommender:submit_prediction' %}",
            data: { test_data : $('#id_test_data').val() },
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            },
            success: function(result) {
                $('#prediction-form')[0].reset();
                load_messages();
            },
            error : function(xhr, errmsg, err) {
                $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+ errmsg +
                    " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
                console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
            }
        })
    });

</script>
